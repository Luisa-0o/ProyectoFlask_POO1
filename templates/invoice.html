{% extends "base.html" %}
{% block title %}Factura #{{ order.id }}{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="card shadow-lg">
    <div class="card-body p-5">
      <!-- Encabezado de Factura -->
      <div class="text-center mb-4">
        <h1 class="text-primary fw-bold">üìã FACTURA DE COMPRA</h1>
        <hr class="my-3">
      </div>

      <!-- Informaci√≥n de Pedido -->
      <div class="row mb-4">
        <div class="col-md-6">
          <h6 class="text-muted text-uppercase mb-3"><strong>Informaci√≥n del Pedido</strong></h6>
          <p class="mb-2"><strong>N√∫mero de Pedido:</strong> #{{ order.id }}</p>
          <p class="mb-2"><strong>Fecha:</strong> {{ order.created_at.strftime('%d/%m/%Y %H:%M') if order.created_at else 'N/A' }}</p>
          <p class="mb-2">
            <strong>Estado:</strong> 
            <span class="badge 
              {% if order.status == 'created' %}bg-secondary
              {% elif order.status == 'paid' %}bg-success
              {% elif order.status == 'shipped' %}bg-info
              {% elif order.status == 'delivered' %}bg-primary
              {% elif order.status == 'cancelled' %}bg-danger
              {% endif %}">
              {{ order.status.upper() }}
            </span>
          </p>
        </div>

        <!-- Informaci√≥n del Cliente -->
        <div class="col-md-6">
          <h6 class="text-muted text-uppercase mb-3"><strong>Informaci√≥n del Cliente</strong></h6>
          <p class="mb-2"><strong>Nombre:</strong> {{ order.user.username }}</p>
          <p class="mb-2"><strong>Email:</strong> {{ order.user.email }}</p>
          <p class="mb-2"><strong>ID Cliente:</strong> {{ order.user.id }}</p>
        </div>
      </div>

      <hr class="my-4">

      <!-- Detalles de Productos -->
      <h6 class="text-muted text-uppercase mb-3"><strong>Detalles del Pedido</strong></h6>
      <div class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead class="table-primary text-white">
            <tr>
              <th>Producto</th>
              <th class="text-center">Cantidad</th>
              <th class="text-end">Precio Unitario</th>
              <th class="text-end">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            {% for item in order.items %}
            <tr>
              <td>
                <strong>{{ item.book.title }}</strong><br>
                <small class="text-muted">Autor: {{ item.book.author }}</small>
              </td>
              <td class="text-center">{{ item.quantity }}</td>
              <td class="text-end">${{ "%.2f"|format(item.price) }}</td>
              <td class="text-end"><strong>${{ "%.2f"|format(item.quantity * item.price) }}</strong></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <hr class="my-4">

      <!-- Resumen de Totales -->
      <div class="row justify-content-end mb-4">
        <div class="col-md-4">
          <div class="card bg-light border-0">
            <div class="card-body">
              <div class="d-flex justify-content-between mb-3">
                <span>Subtotal:</span>
                <span>${{ "%.2f"|format(order.total) }}</span>
              </div>
              <div class="d-flex justify-content-between mb-3">
                <span>Impuestos:</span>
                <span>$0.00</span>
              </div>
              <hr>
              <div class="d-flex justify-content-between">
                <strong class="fs-5">Total:</strong>
                <strong class="fs-5 text-primary">${{ "%.2f"|format(order.total) }}</strong>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Informaci√≥n de Pago -->
      <div class="alert alert-info mt-4 mb-4">
        <h6 class="text-muted text-uppercase mb-3"><strong>Informaci√≥n de Pago</strong></h6>
        <p class="mb-1"><strong>M√©todo de Pago:</strong> Tarjeta de Cr√©dito</p>
        <p class="mb-1"><strong>Estado del Pago:</strong> {{ order.status.upper() }}</p>
        <p class="mb-0"><strong>Fecha de Procesamiento:</strong> {{ order.created_at.strftime('%d/%m/%Y') if order.created_at else 'N/A' }}</p>
      </div>

      <!-- Pie de P√°gina -->
      <div class="text-center mt-5 pt-4 border-top text-muted small">
        <p>‚úÖ Gracias por tu compra. Este es tu comprobante oficial.</p>
        <p>Gu√°rdalo para tus registros. Si tienes preguntas, cont√°ctanos.</p>
        <p class="mt-3"><small>Generado: {{ now.strftime('%d/%m/%Y %H:%M:%S') if now else 'N/A' }}</small></p>
      </div>

      <!-- Botones de Acci√≥n -->
      <div class="d-flex gap-2 justify-content-center mt-4">
        <button class="btn btn-primary" onclick="window.print()">
          üñ®Ô∏è Imprimir Factura
        </button>
        <a href="{{ url_for('payment') }}" class="btn btn-success">
          üí≥ Continuar con el Pago
        </a>
      </div>
    </div>
  </div>
</div>

<style>
  @media print {
    .btn, .navbar, footer {
      display: none !important;
    }
    .card {
      box-shadow: none !important;
      border: 1px solid #dee2e6 !important;
    }
  }
</style>
{% endblock %}
